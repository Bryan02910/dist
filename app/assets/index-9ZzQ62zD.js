import{r as a,M as de,j as e}from"./index-UyDEpSKi.js";import{T as ce,A as x}from"./ToastAutoHide-mD-74I2T.js";import{P as me}from"./Page-DWSL0diS.js";import{C as ue,E as k}from"./CommonTable-CihJZmSo.js";import{E as he}from"./jspdf.plugin.autotable-DmuIJyGd.js";import{i as xe}from"./index-tCDBB_r2.js";import{D as M,a as P,b as R,c as F}from"./TableCell-B8HtnHjl.js";import{T as B,B as pe}from"./Box-BLXI0_F0.js";import{B as p}from"./Button-CjDs8j-X.js";import{I as g}from"./Grow-41TwNg0m.js";import{C as ge}from"./Close-Di1FhIrO.js";import{G as i}from"./Grid-CfjZ72w2.js";import{T as d,I as L,S as O}from"./TextField-BGn-4xfW.js";import{M as f}from"./MenuItem-B_SiXQ1x.js";import{C as fe}from"./Container-uQWJgnJV.js";import{A as je,D as q}from"./DeleteOutline-DAPNekcB.js";import{D as ve}from"./DownloadOutlined-D6SfjWqt.js";import{a as De}from"./Menu-9ysSaJL7.js";import{S as G}from"./Stack-CILUL872.js";import{D as _}from"./createSvgIcon-Cv_souYI.js";import"./ButtonBase-Bhi2RUyb.js";import"./TablePagination-CBjQ43ZL.js";import"./Toolbar-D0r--W_a.js";import"./useThemeProps-D04-WiJJ.js";const Qe=()=>{const{globalState:j}=a.useContext(de),[w,H]=a.useState(),v={username:"",user:"",password:"",correo:"",carnet:"",rol:"",descripcion:"",dpi:"",telefono:"",direccion:"",estado:""},[y,J]=a.useState([]),[o,m]=a.useState(v),[Y,K]=a.useState(!1),[b,D]=a.useState(!1),[Q,u]=a.useState({ident:null,message:null,type:null}),[S,N]=a.useState(null),[V,X]=a.useState(!1),[Ce,Z]=a.useState([]),[$,ee]=a.useState([]),[T,E]=a.useState(""),C=async()=>{const{data:t}=await x().get("/usuarios");J(t)},te=[{field:"id",headerName:"ID",width:120},{field:"username",headerName:"Usuario",width:220},{field:"user",headerName:"Nombre",width:220},{field:"password",headerName:"Password",width:220},{field:"correo",headerName:"Correo",width:220},{field:"carnet",headerName:"Carnet",width:220},{field:"descripcion",headerName:"Descripcion",width:220},{field:"dpi",headerName:"DPI",width:220},{field:"telefono",headerName:"Teléfono",width:220},{field:"direccion",headerName:"Dirección",width:220},{field:"estado",headerName:"Estado",width:220},{field:"",headerName:"Acciones",width:200,renderCell:t=>e.jsx(G,{direction:"row",divider:e.jsx(_,{orientation:"vertical",flexItem:!0}),justifyContent:"center",alignItems:"center",spacing:2,children:w==="ADMIN"&&e.jsxs(e.Fragment,{children:[e.jsx(g,{size:"small",onClick:()=>{D(!0),m(t.row),c()},children:e.jsx(k,{})}),e.jsx(g,{size:"small",onClick:()=>{h(),N(t.id)},children:e.jsx(q,{})})]})})}],se=async()=>{try{const t=y.find(l=>l.id===S);Z(l=>[...l,t]);const{data:s}=await x().post("/eliminar",{id:S});u({ident:new Date().getTime(),message:s.message,type:"success"}),h(),C()}catch({response:t}){u({ident:new Date().getTime(),message:t.data.sqlMessage,type:"error"})}},c=()=>{K(t=>!t)},h=()=>{X(t=>!t)},n=({target:t})=>{const{name:s,value:l}=t;m({...o,[s]:s==="rol"?Number(l):l})},ae=async()=>{try{const{data:t}=await x().post("/guardar",o);c(),m(v),u({ident:new Date().getTime(),message:t.message,type:"success"}),C(),D(!1)}catch({response:t}){u({ident:new Date().getTime(),message:t.data.sqlMessage,type:"error"})}},ie=async()=>{try{const t={...o};T?t.password=T:delete t.password;const{data:s}=await x().post("/editar",t);c(),m(v),E(""),u({ident:new Date().getTime(),message:s.message,type:"success"}),C()}catch({response:t}){u({ident:new Date().getTime(),message:t.data.sqlMessage,type:"error"})}},[z,U]=a.useState(null),re=t=>{U(t.currentTarget)},I=()=>{U(null)},W=t=>{const s=new he("landscape","mm","a4"),l=xe.Logo,A=()=>{s.addImage(l,"JPEG",s.internal.pageSize.getWidth()-40-10,10,40,30)},ne=y.filter(r=>t?r.estado==="Activo":r.estado==="Inactivo").map(r=>[r.id.toString(),r.username,r.user,r.carnet,r.descripcion,r.dpi,r.telefono,r.estado]),le=["ID","Usuario","Nombre","Carnet","Rol","DPI","Teléfono","Estado"];A(),s.setFontSize(12),s.text(t?"Reporte de Usuarios Activos":"Reporte de Usuarios Inactivos",10,25),s.autoTable({head:[le],body:ne,startY:30,theme:"grid",styles:{fontSize:10,cellPadding:3},headStyles:{fillColor:[22,160,133]},didDrawPage:r=>{A()}}),s.save(t?"reporte_usuarios_activos.pdf":"reporte_usuarios_inactivos.pdf")},oe=async()=>{try{const t=await x().get("/roles");ee(t.data)}catch(t){console.error("Error fetching roles data:",t)}};return a.useEffect(()=>{oe(),C()},[]),a.useEffect(()=>{j.auth&&j.auth.rol&&H(j.auth.rol)},[j]),e.jsxs(e.Fragment,{children:[e.jsxs(M,{maxWidth:"xs",open:V,onClose:h,children:[e.jsx(P,{children:"¿Desea eliminar este usuario?"}),e.jsx(R,{children:e.jsx(B,{variant:"body1",color:"textSecondary",children:"Esta acción es irreversible."})}),e.jsxs(F,{children:[e.jsx(p,{variant:"text",color:"primary",onClick:h,children:"Cancelar"}),e.jsx(p,{variant:"contained",color:"primary",onClick:se,children:"Aceptar"})]})]}),e.jsxs(M,{maxWidth:"xs",open:Y,onClose:c,children:[e.jsxs(P,{children:[b?"Editar Usuario":"Crear Usuario",e.jsx(g,{"aria-label":"close",onClick:c,style:{position:"absolute",right:8,top:8},children:e.jsx(ge,{})})]}),e.jsx(R,{dividers:!0,children:e.jsxs(i,{container:!0,spacing:2,children:[e.jsx(i,{item:!0,xs:12,children:e.jsx(d,{margin:"normal",name:"username",value:o.username,onChange:n,variant:"outlined",size:"small",fullWidth:!0,label:"Nombre de usuario"})}),e.jsx(i,{item:!0,xs:12,children:e.jsx(d,{margin:"normal",name:"user",value:o.user,onChange:n,variant:"outlined",size:"small",fullWidth:!0,label:"Nombre"})}),e.jsx(i,{item:!0,xs:12,children:e.jsx(d,{margin:"normal",name:"password",onChange:({target:t})=>E(t.value),variant:"outlined",size:"small",fullWidth:!0,label:"Contraseña",type:"password"})}),e.jsx(i,{item:!0,xs:12,children:e.jsx(d,{margin:"normal",name:"correo",value:o.correo,onChange:n,variant:"outlined",size:"small",fullWidth:!0,label:"Correo"})}),e.jsx(i,{item:!0,xs:12,children:e.jsx(d,{margin:"normal",name:"carnet",value:o.carnet,onChange:n,variant:"outlined",size:"small",fullWidth:!0,label:"Carnet"})}),e.jsxs(i,{item:!0,xs:12,children:[e.jsx(L,{htmlFor:"rol",children:"Rol del usuario"}),e.jsx(O,{name:"rol",value:o.rol||"",onChange:n,variant:"outlined",size:"small",fullWidth:!0,children:$.map(t=>e.jsx(f,{value:t.id,children:t.descripcion},t.id))})]}),e.jsx(i,{item:!0,xs:12,children:e.jsx(d,{margin:"normal",name:"dpi",value:o.dpi,onChange:n,variant:"outlined",size:"small",fullWidth:!0,label:"DPI"})}),e.jsx(i,{item:!0,xs:12,children:e.jsx(d,{margin:"normal",name:"telefono",value:o.telefono,onChange:n,variant:"outlined",size:"small",fullWidth:!0,label:"Teléfono"})}),e.jsx(i,{item:!0,xs:12,children:e.jsx(d,{margin:"normal",name:"direccion",value:o.direccion,onChange:n,variant:"outlined",size:"small",fullWidth:!0,label:"Dirección"})}),e.jsxs(i,{item:!0,xs:12,children:[e.jsx(L,{htmlFor:"estado",children:"Estado del usuario"}),e.jsxs(O,{name:"estado",value:o.estado,onChange:n,variant:"outlined",size:"small",fullWidth:!0,children:[e.jsx(f,{value:"Activo",children:"Activo"}),e.jsx(f,{value:"Inactivo",children:"Inactivo"})]})]})]})}),e.jsx(F,{children:e.jsx(p,{variant:"contained",color:"primary",onClick:b?ie:ae,children:"Guardar"})})]}),e.jsxs(me,{title:"Chapina | Usuarios",children:[e.jsx(ce,{message:Q}),e.jsxs(fe,{maxWidth:"lg",children:[e.jsx(pe,{sx:{pb:5},children:e.jsx(B,{variant:"h4",children:"Lista de usuarios"})}),e.jsx(i,{container:!0,spacing:2,justifyContent:"space-between",alignItems:"center",children:w==="ADMIN"&&e.jsxs(i,{item:!0,children:[e.jsx(p,{onClick:()=>{D(!1),c(),m(v)},startIcon:e.jsx(je,{}),variant:"contained",color:"primary",children:"Nuevo"}),e.jsx(p,{onClick:re,startIcon:e.jsx(ve,{}),variant:"contained",color:"secondary",sx:{ml:2},children:"Descargar Reporte"}),e.jsxs(De,{anchorEl:z,open:!!z,onClose:I,children:[e.jsx(f,{onClick:()=>{W(!0),I()},children:"Usuarios Activos"}),e.jsx(f,{onClick:()=>{W(!1),I()},children:"Usuarios Inactivos"})]})]})}),e.jsx(i,{container:!0,spacing:2,sx:{mt:2},children:e.jsx(i,{item:!0,xs:12,children:e.jsx(ue,{data:y,columns:te.map(t=>t.field===""?{...t,renderCell:s=>e.jsx(G,{direction:"row",divider:e.jsx(_,{orientation:"vertical",flexItem:!0}),justifyContent:"center",alignItems:"center",spacing:2,children:w==="ADMIN"&&e.jsxs(e.Fragment,{children:[e.jsx(g,{size:"small",onClick:()=>{D(!0),m(s.row),c()},children:e.jsx(k,{})}),e.jsx(g,{size:"small",onClick:()=>{h(),N(s.id)},children:e.jsx(q,{})})]})})}:t)})})})]})]})]})};export{Qe as default};
