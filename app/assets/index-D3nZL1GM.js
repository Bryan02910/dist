import{r as s,M as L,j as e}from"./index-UyDEpSKi.js";import{T as R,A as m}from"./ToastAutoHide-mD-74I2T.js";import{P as _}from"./Page-DWSL0diS.js";import{C as G,E as P}from"./CommonTable-CihJZmSo.js";import{D,a as C,c as y,b as U}from"./TableCell-B8HtnHjl.js";import{B as x}from"./Button-CjDs8j-X.js";import{G as a}from"./Grid-CfjZ72w2.js";import{T as H,I as J,S as K}from"./TextField-BGn-4xfW.js";import{M as w}from"./MenuItem-B_SiXQ1x.js";import{C as Q}from"./Container-uQWJgnJV.js";import{B as V,T as X}from"./Box-BLXI0_F0.js";import{A as Y,D as Z}from"./DeleteOutline-DAPNekcB.js";import{S as $}from"./Stack-CILUL872.js";import{D as ee}from"./createSvgIcon-Cv_souYI.js";import{I as v}from"./Grow-41TwNg0m.js";import"./ButtonBase-Bhi2RUyb.js";import"./Menu-9ysSaJL7.js";import"./TablePagination-CBjQ43ZL.js";import"./Toolbar-D0r--W_a.js";import"./useThemeProps-D04-WiJJ.js";const ye=()=>{const{globalState:c}=s.useContext(L),[g,I]=s.useState(),n={id:"",nombre:"",correo:"",dpi:"",nit:"",telefono:"",direccion:"",estado:""},[T,S]=s.useState([]),[o,r]=s.useState(n),[A,N]=s.useState(!1),[j,h]=s.useState(!1),[b,i]=s.useState({ident:null,message:null,type:null}),[E,M]=s.useState(null),[k,B]=s.useState(!1),d=async()=>{const{data:t}=await m().get("/cliente_select");S(t)},O=[{field:"id",headerName:"ID",width:120},{field:"nombre",headerName:"Nombre",width:200},{field:"correo",headerName:"Correo",width:220},{field:"dpi",headerName:"DPI",width:150},{field:"nit",headerName:"NIT",width:120},{field:"telefono",headerName:"Teléfono",width:150},{field:"direccion",headerName:"Dirección",width:200},{field:"estado",headerName:"Estado",width:100},{field:"",headerName:"Acciones",width:200,renderCell:t=>e.jsx($,{direction:"row",divider:e.jsx(ee,{orientation:"vertical",flexItem:!0}),justifyContent:"center",alignItems:"center",spacing:2,children:g==="ADMIN"&&e.jsxs(e.Fragment,{children:[e.jsx(v,{size:"small",onClick:()=>{h(!0),r(t.row),l()},children:e.jsx(P,{})}),e.jsx(v,{size:"small",onClick:()=>{u(),M(t.id)},children:e.jsx(Z,{})})]})})}],W=async()=>{try{const{data:t}=await m().post("/eliminar_cliente",{id:E});i({ident:new Date().getTime(),message:t.message,type:"success"}),u(),d()}catch({response:t}){i({ident:new Date().getTime(),message:t.data.sqlMessage,type:"error"})}},l=()=>{N(t=>!t)},u=()=>{B(t=>!t)},f=({target:t})=>{const{name:p,value:F}=t;r({...o,[p]:F})},q=async()=>{try{const{data:t}=await m().post("/guardar_cliente",o);l(),r(n),i({ident:new Date().getTime(),message:t.message,type:"success"}),d(),h(!1)}catch({response:t}){i({ident:new Date().getTime(),message:t.data.sqlMessage,type:"error"})}},z=async()=>{try{const{data:t}=await m().post("/editar_cliente",o);l(),r(n),i({ident:new Date().getTime(),message:t.message,type:"success"}),d()}catch({response:t}){i({ident:new Date().getTime(),message:t.data.sqlMessage,type:"error"})}};return s.useEffect(()=>{d()},[]),s.useEffect(()=>{c.auth&&c.auth.rol&&I(c.auth.rol)},[c]),e.jsxs(e.Fragment,{children:[e.jsxs(D,{maxWidth:"xs",open:k,onClose:u,children:[e.jsx(C,{children:"¿Desea eliminar este cliente?"}),e.jsx(y,{children:e.jsx(x,{variant:"contained",color:"primary",onClick:W,children:"Aceptar"})})]}),e.jsxs(D,{maxWidth:"xs",open:A,onClose:l,children:[e.jsx(C,{children:j?"Editar cliente":"Crear cliente"}),e.jsx(U,{dividers:!0,children:e.jsxs(a,{container:!0,spacing:2,children:[Object.keys(n).map((t,p)=>t!=="id"&&t!=="estado"&&e.jsx(a,{item:!0,xs:12,children:e.jsx(H,{name:t,value:o[t],onChange:f,variant:"outlined",size:"small",fullWidth:!0,label:t.charAt(0).toUpperCase()+t.slice(1)})},p)),e.jsxs(a,{item:!0,xs:12,children:[e.jsx(J,{htmlFor:"estado",children:"Estado del cliente"}),e.jsxs(K,{name:"estado",value:o.estado||"Activo",onChange:f,variant:"outlined",size:"small",fullWidth:!0,children:[e.jsx(w,{value:"Activo",children:"Activo"}),e.jsx(w,{value:"Inactivo",children:"Inactivo"})]})]})]})}),e.jsx(y,{children:e.jsx(x,{variant:"contained",color:"primary",onClick:j?z:q,children:"Guardar"})})]}),e.jsxs(_,{title:"Chapina | Clientes",children:[e.jsx(R,{message:b}),e.jsxs(Q,{maxWidth:"lg",children:[e.jsx(V,{sx:{pb:5},children:e.jsx(X,{variant:"h4",children:"Lista de clientes"})}),e.jsx(a,{container:!0,spacing:2,justifyContent:"space-between",alignItems:"center",children:g==="ADMIN"&&e.jsx(a,{item:!0,children:e.jsx(x,{onClick:()=>{h(!1),l(),r(n)},startIcon:e.jsx(Y,{}),variant:"contained",color:"primary",children:"Nuevo"})})}),e.jsx(a,{container:!0,spacing:2,sx:{mt:2},children:e.jsx(a,{item:!0,xs:12,children:e.jsx(G,{data:T,columns:O})})})]})]})]})};export{ye as default};
